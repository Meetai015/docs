---
title: "Build & Production"
description: "Building the Gistly frontend for production"
icon: "build"
---

# Build & Production

## Development Build

### Run Development Server

```bash
npm run dev
```

The dev server runs with:
- **Fast Refresh** - Hot module replacement
- **Source maps** - Full debugging info
- **No minification** - Readable code
- **Verbose errors** - Detailed error messages

## Production Build

### Build Command

```bash
npm run build
```

This creates an optimized production build in the `.next/` directory.

### Build Output

The build process:
1. **Compiles** TypeScript to JavaScript
2. **Minifies** code to reduce bundle size
3. **Optimizes** images and assets
4. **Generates** static pages where possible
5. **Creates** server-side bundles

### Build Output Structure

```
.next/
├── server/              # Server-side bundles
│   ├── pages/          # API routes and server components
│   └── chunks/         # Shared server chunks
├── static/             # Static assets
│   ├── chunks/         # Client-side JavaScript
│   ├── media/          # Optimized images
│   └── css/            # CSS bundles
└── cache/              # Build cache
```

## Build Configuration

### next.config.js

```javascript
/** @type {import('next').NextConfig} */
const nextConfig = {
  // Enable React strict mode
  reactStrictMode: true,

  // Optimize package imports
  modularizeImports: {
    'lodash-es': {
      transform: 'lodash-es/{{member}}',
    },
  },

  // Image domains
  images: {
    domains: ['cdn.gistly.ai'],
    formats: ['image/avif', 'image/webp'],
  },

  // Environment variables
  env: {
    NEXT_PUBLIC_APP_VERSION: process.env.npm_package_version,
  },

  // Headers for security
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          {
            key: 'X-DNS-Prefetch-Control',
            value: 'on',
          },
          {
            key: 'X-Frame-Options',
            value: 'SAMEORIGIN',
          },
        ],
      },
    ];
  },

  // Webpack configuration
  webpack: (config, { isServer }) => {
    // Custom webpack config
    return config;
  },
};
```

## Environment Variables

### Production Variables

Create `.env.production`:

```bash
# Backend API
NEXT_PUBLIC_API_URL=https://api.gistly.ai/api/v1

# Analytics
NEXT_PUBLIC_GA_ID=G-XXXXXXXXXX

# Feature flags
NEXT_PUBLIC_ENABLE_ANALYTICS=true
NEXT_PUBLIC_ENABLE_SENTRY=true

# Sentry
NEXT_PUBLIC_SENTRY_DSN=https://...@sentry.io/...
SENTRY_AUTH_TOKEN=your-auth-token

# Deployment
NEXT_PUBLIC_APP_URL=https://app.gistly.ai
```

### Loading Environment Variables

```typescript
// Ensure variables are loaded at build time
const apiUrl = process.env.NEXT_PUBLIC_API_URL;
if (!apiUrl) {
  throw new Error('NEXT_PUBLIC_API_URL is not defined');
}
```

## Performance Optimization

### Code Splitting

Next.js automatically code-splits by route. For manual splitting:

```typescript
// Dynamic import for code splitting
import dynamic from 'next/dynamic';

const HeavyComponent = dynamic(
  () => import('@/components/heavy-component'),
  {
    loading: () => <div>Loading...</div>,
    ssr: false, // Disable SSR for this component
  }
);
```

### Bundle Analysis

```bash
npm run build -- --analyze
```

This opens a bundle analyzer showing:
- Package sizes
- Dependencies
- Optimization opportunities

### Image Optimization

```tsx
import Image from 'next/image';

export function Avatar({ src, alt }: { src: string; alt: string }) {
  return (
    <Image
      src={src}
      alt={alt}
      width={100}
      height={100}
      loading="lazy"
      placeholder="blur"
    />
  );
}
```

### Font Optimization

```tsx
// next/font for optimized fonts
import { Inter } from 'next/font/google';

const inter = Inter({ subsets: ['latin'] });

export default function RootLayout({ children }) {
  return (
    <html lang="en" className={inter.className}>
      <body>{children}</body>
    </html>
  );
}
```

## Testing the Build

### Local Production Preview

```bash
npm run build
npm run start
```

This serves the production build locally for testing.

### Pre-deployment Checklist

- [ ] All environment variables set
- [ ] Build completes without errors
- [ ] Test the production build locally
- [ ] Verify API connectivity
- [ ] Check authentication flow
- [ ] Test critical user paths
- [ ] Verify analytics tracking
- [ ] Check error tracking (Sentry)

## Build Troubleshooting

### Out of Memory Errors

```bash
# Increase Node.js memory limit
NODE_OPTIONS="--max-old-space-size=8192" npm run build
```

### Type Errors

```bash
# Run TypeScript check
npx tsc --noEmit
```

### Build Warnings

Address common warnings:
- Unused dependencies
- Large bundles (> 200KB)
- Missing dependencies
- Deprecated APIs

## Next Steps

- Deploy to [Production](/frontend/deployment)
- Set up [Monitoring](/backend/monitoring)
